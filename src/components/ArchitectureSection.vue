<script setup>
import { ref, onMounted } from 'vue'
import { useScrollAnimation } from '../composables/useScrollAnimation'

const sectionRef = ref(null)
const { observeElements } = useScrollAnimation()

onMounted(() => {
  observeElements('.arch-animate', sectionRef.value)
})

const systemPatterns = [
  {
    icon: 'üèõÔ∏è',
    name: 'MVC / MTV',
    full: 'Model-View-Controller',
    desc: 'Django usa MTV (Model-Template-View) ‚Äî o mesmo conceito com outro nome. Usei na AGK para organizar rotas, modelos e l√≥gica de controle no ERP.',
    tag: 'Backend',
    tagColor: 'text-blue-400 bg-blue-400/10 border-blue-400/30',
  },
  {
    icon: 'üß±',
    name: 'Monolito',
    full: 'Monolithic Architecture',
    desc: 'O ERP da AGK e os sistemas da Gali rodam como aplica√ß√µes √∫nicas: API, regras de neg√≥cio e banco no mesmo processo/deploy.',
    tag: 'Backend',
    tagColor: 'text-blue-400 bg-blue-400/10 border-blue-400/30',
  },
  {
    icon: 'üß¨',
    name: 'Componentiza√ß√£o',
    full: 'Component-Based Architecture',
    desc: 'Tr√™s anos construindo SPAs com Vue. Cada tela virou componentes reutiliz√°veis ‚Äî do bot√£o ao m√≥dulo completo, cada um com uma √∫nica responsabilidade.',
    tag: 'Frontend',
    tagColor: 'text-green-400 bg-green-400/10 border-green-400/30',
  },
  {
    icon: '‚ö°',
    name: 'Serverless / FaaS',
    full: 'Function as a Service',
    desc: 'Na Gali, cada opera√ß√£o era uma Lambda separada: criar, listar, buscar, excluir, upload. Estrutura handler/common ‚Äî o common centralizava valida√ß√µes e acesso ao DynamoDB, o handler executava a l√≥gica.',
    tag: 'Cloud',
    tagColor: 'text-orange-400 bg-orange-400/10 border-orange-400/30',
  },
  {
    icon: 'üîó',
    name: 'REST APIs',
    full: 'RESTful API Design',
    desc: 'Desenvolvi e consumi APIs REST em todos os projetos: endpoints para criar, listar, buscar, excluir, busca personalizada e upload de arquivo ‚Äî contratos claros entre front e back.',
    tag: 'Full Stack',
    tagColor: 'text-purple-400 bg-purple-400/10 border-purple-400/30',
  },
  {
    icon: 'üì¶',
    name: 'SPA',
    full: 'Single Page Application',
    desc: 'Todos os frontends que desenvolvi s√£o SPAs com Vue ‚Äî carga inicial √∫nica, navega√ß√£o din√¢mica sem reload e atualiza√ß√£o parcial de dados.',
    tag: 'Frontend',
    tagColor: 'text-green-400 bg-green-400/10 border-green-400/30',
  },
]

const codePatterns = [
  {
    icon: 'üóÉÔ∏è',
    name: 'DTO + Module Classes',
    full: 'Data Transfer Object',
    desc: 'Para cada m√≥dulo (contratos, obras, clientes) criava uma classe respons√°vel por formatar os dados do formul√°rio antes de enviar ao backend ‚Äî sem l√≥gica espalhada.',
    example: 'new CreateContratoDTO(formData)',
    tag: 'Favorito',
    tagColor: 'text-accent bg-accent/10 border-accent/30',
  },
  {
    icon: 'üîê',
    name: 'Auth Guard / JWT',
    full: 'Token-Based Authentication',
    desc: 'Toda rota protegida validava o JWT antes de processar. O backend aguardava a chave, recusava requests inv√°lidos e as URLs ficavam protegidas ‚Äî sem expor l√≥gica ao front.',
    example: 'verifyToken(req) ‚Üí next() | 401',
    tag: 'Seguran√ßa',
    tagColor: 'text-red-400 bg-red-400/10 border-red-400/30',
  },
  {
    icon: '‚úÇÔ∏è',
    name: 'SRP',
    full: 'Single Responsibility Principle',
    desc: 'Cada Lambda fazia exatamente uma coisa: uma para criar, uma para listar, uma para buscar, uma para excluir, uma para upload. Sem fun√ß√£o que serve pra tudo.',
    example: 'createItem / listItems / uploadFile',
    tag: 'SOLID',
    tagColor: 'text-yellow-400 bg-yellow-400/10 border-yellow-400/30',
  },
  {
    icon: 'üóÇÔ∏è',
    name: 'Handler / Common',
    full: 'Separation of Concerns + DRY',
    desc: 'No serverless, separava em dois arquivos: common centralizava valida√ß√µes, conex√£o com DynamoDB e utilit√°rios compartilhados; handler tinha s√≥ a l√≥gica da fun√ß√£o.',
    example: 'common.validate() + handler(event)',
    tag: 'Backend',
    tagColor: 'text-blue-400 bg-blue-400/10 border-blue-400/30',
  },
  {
    icon: 'üîÅ',
    name: 'Composables',
    full: 'Composition / Custom Hook',
    desc: 'Em Vue 3, extra√≠ l√≥gica reutiliz√°vel em composables ‚Äî estado e comportamento separados da UI, reaproveitados em m√∫ltiplos componentes.',
    example: 'const { data } = useContrato(id)',
    tag: 'Frontend',
    tagColor: 'text-green-400 bg-green-400/10 border-green-400/30',
  },
  {
    icon: 'üëÅÔ∏è',
    name: 'Reatividade',
    full: 'Observer / Reactivity Pattern',
    desc: 'O sistema de reatividade do Vue √© o padr√£o Observer na pr√°tica ‚Äî quando um dado muda, tudo que depende dele atualiza automaticamente. Usei em todos os projetos.',
    example: 'watch(filtro, () => buscarDados())',
    tag: 'Frontend',
    tagColor: 'text-green-400 bg-green-400/10 border-green-400/30',
  },
]
</script>

<template>
  <section id="architecture" class="py-20 bg-card" ref="sectionRef">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Section header -->
      <div class="arch-animate text-center mb-6">
        <span class="text-accent text-sm font-mono font-medium tracking-widest uppercase">// 03</span>
        <h2 class="text-3xl sm:text-4xl font-bold text-text-main mt-2">Arquitetura</h2>
        <p class="text-text-muted mt-3 max-w-xl mx-auto leading-relaxed">
          Al√©m do c√≥digo ‚Äî padr√µes e estruturas que j√° apliquei em sistemas reais.
          Muitos eu usei antes de saber o nome.
        </p>
      </div>

      <!-- Divider label -->
      <div class="arch-animate flex items-center gap-4 mb-8 mt-12">
        <div class="flex-1 h-px bg-surface" />
        <span class="text-text-muted text-xs font-mono uppercase tracking-widest px-2">Padr√µes de Sistema</span>
        <div class="flex-1 h-px bg-surface" />
      </div>

      <!-- System architecture patterns -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-12">
        <div
          v-for="p in systemPatterns"
          :key="p.name"
          class="arch-animate group bg-surface rounded-xl p-5 border border-surface/50 hover:border-accent/25 transition-all duration-300 card-hover"
        >
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-2.5">
              <span class="text-2xl">{{ p.icon }}</span>
              <div>
                <div class="text-text-main font-semibold text-sm leading-tight">{{ p.name }}</div>
                <div class="text-text-muted text-xs mt-0.5">{{ p.full }}</div>
              </div>
            </div>
            <span class="text-xs px-2 py-0.5 rounded-full border flex-shrink-0 font-medium" :class="p.tagColor">
              {{ p.tag }}
            </span>
          </div>
          <p class="text-text-muted text-sm leading-relaxed">{{ p.desc }}</p>
        </div>
      </div>

      <!-- Divider label -->
      <div class="arch-animate flex items-center gap-4 mb-8">
        <div class="flex-1 h-px bg-surface" />
        <span class="text-text-muted text-xs font-mono uppercase tracking-widest px-2">Design Patterns</span>
        <div class="flex-1 h-px bg-surface" />
      </div>

      <!-- Code design patterns -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-12">
        <div
          v-for="p in codePatterns"
          :key="p.name"
          class="arch-animate group bg-surface rounded-xl p-5 border border-surface/50 hover:border-accent/25 transition-all duration-300 card-hover"
        >
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-2.5">
              <span class="text-2xl">{{ p.icon }}</span>
              <div>
                <div class="text-text-main font-semibold text-sm leading-tight">{{ p.name }}</div>
                <div class="text-text-muted text-xs mt-0.5">{{ p.full }}</div>
              </div>
            </div>
            <span class="text-xs px-2 py-0.5 rounded-full border flex-shrink-0 font-medium" :class="p.tagColor">
              {{ p.tag }}
            </span>
          </div>
          <p class="text-text-muted text-sm leading-relaxed mb-3">{{ p.desc }}</p>
          <!-- Code snippet -->
          <div class="bg-primary rounded-lg px-3 py-2 font-mono text-xs text-accent/80 border border-surface/50">
            {{ p.example }}
          </div>
        </div>
      </div>

      <!-- Footer note -->
      <div class="arch-animate text-center">
        <p class="text-text-muted text-sm italic max-w-lg mx-auto">
          "Nunca fui bom com nomes ‚Äî mas o c√≥digo j√° seguia esses padr√µes
          <span class="text-accent not-italic font-medium">antes de eu saber que existiam.</span>"
        </p>
      </div>

    </div>
  </section>
</template>
